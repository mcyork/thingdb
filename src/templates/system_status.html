{% extends "base.html" %}

{% block title %}System Status{% endblock %}

{% block styles %}
<style>
    .status-header {
        text-align: center;
        margin-bottom: 24px;
    }
    .status-badge {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 8px;
    }
    .status-healthy {
        background: #d4edda;
        color: #155724;
    }
    .status-unhealthy {
        background: #f8d7da;
        color: #721c24;
    }
    .status-subtitle {
        color: var(--text-light);
        font-size: 14px;
    }
    .status-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 16px;
    }
    @media (min-width: 768px) {
        .status-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    .section-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 12px;
    }
    .section-icon { font-size: 20px; }
    .section-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-dark);
        margin: 0;
    }
    .status-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid var(--background-light);
        font-size: 14px;
    }
    .status-row:last-child { border-bottom: none; }
    .status-label { color: var(--text-light); }
    .status-value { font-weight: 600; color: var(--text-dark); }
    .status-good { color: var(--success-color); }
    .status-warning { color: var(--warning-color); }
    .status-danger { color: var(--danger-color); }
    .progress-bar {
        width: 80px;
        height: 6px;
        background: #e9ecef;
        border-radius: 3px;
        overflow: hidden;
    }
    .progress-fill { height: 100%; }
    .version-info {
        text-align: center;
        margin-top: 24px;
        font-size: 12px;
        color: var(--text-light);
    }
</style>
{% endblock %}

{% block app_content %}
<div class="sub-header">
    <div class="sub-header-content">
        <button onclick="history.back()" class="sub-header-back-btn">‚Üê</button>
        <h1 class="sub-header-title">System Status</h1>
    </div>
</div>

<div class="app-content">
    <div class="status-header">
        {% if error %}
            <div class="status-badge status-unhealthy">‚ùå System Unhealthy</div>
            <p class="status-subtitle">An error was detected. See details below.</p>
        {% else %}
            <div class="status-badge status-healthy">‚úÖ All Systems Operational</div>
            <p class="status-subtitle">Response: {{ status.response_time }}ms ‚Ä¢ Version {{ status.app_version }}{% if status.app_rc %} ({{ status.app_rc }}){% endif %}</p>
        {% endif %}
    </div>
    
    {% if error %}
        <div class="card">
            <h3 class="section-title">Error Details</h3>
            <p style="color: var(--danger-color);">{{ status.error }}</p>
        </div>
    {% else %}
        <div class="status-grid">
            <div class="card">
                <div class="section-header"><span class="section-icon">üóÑÔ∏è</span><h3 class="section-title">Database</h3></div>
                <div class="status-row"><span class="status-label">Connection</span><span class="status-value status-good">{{ status.database.status.title() }}</span></div>
                <div class="status-row"><span class="status-label">Response Time</span><span class="status-value">{{ status.database.response_time }}ms</span></div>
                <div class="status-row"><span class="status-label">Total Size</span><span class="status-value">{{ status.database.size }}</span></div>
                <div class="status-row"><span class="status-label">Images Table</span><span class="status-value">{{ status.database.images_size }}</span></div>
            </div>
            
            <div class="card">
                <div class="section-header"><span class="section-icon">‚ö°</span><h3 class="section-title">System Resources</h3></div>
                <div class="status-row">
                    <span class="status-label">CPU Usage</span>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="progress-bar"><div class="progress-fill" style="width: {{ status.system.cpu_percent }}%; background-color: var(--success-color);"></div></div>
                        <span class="status-value">{{ "%.1f"|format(status.system.cpu_percent) }}%</span>
                    </div>
                </div>
                <div class="status-row">
                    <span class="status-label">Memory Usage</span>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="progress-bar"><div class="progress-fill" style="width: {{ status.system.memory_percent }}%; background-color: var(--{% if status.system.memory_percent < 90 %}success{% else %}danger{% endif %}-color);"></div></div>
                        <span class="status-value">{{ "%.1f"|format(status.system.memory_percent) }}%</span>
                    </div>
                </div>
                <div class="status-row">
                    <span class="status-label">Disk Usage</span>
                     <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="progress-bar"><div class="progress-fill" style="width: {{ status.system.disk_percent }}%; background-color: var(--{% if status.system.disk_percent < 90 %}success{% else %}danger{% endif %}-color);"></div></div>
                        <span class="status-value">{{ "%.1f"|format(status.system.disk_percent) }}%</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="section-header"><span class="section-icon">üíæ</span><h3 class="section-title">Cache</h3></div>
                <div class="status-row"><span class="status-label">Image Cache</span><span class="status-value">{{ status.cache.image_cache_size }}/{{ status.cache.image_cache_max }}</span></div>
                <div class="status-row"><span class="status-label">Thumbnail Cache</span><span class="status-value">{{ status.cache.thumbnail_cache_size }}/{{ status.cache.thumbnail_cache_max }}</span></div>
            </div>

            <div class="card">
                <div class="section-header"><span class="section-icon">üîó</span><h3 class="section-title">Connection Pool</h3></div>
                <div class="status-row"><span class="status-label">Active</span><span class="status-value">{{ status.connection_pool.active_connections }}/{{ status.connection_pool.max_pool_size }}</span></div>
                <div class="status-row"><span class="status-label">Status</span><span class="status-value status-good">Healthy</span></div>
            </div>
        </div>
    {% endif %}
    
    <div class="version-info">
        Inventory Management System v{% if status.app_rc %}{{ status.app_rc }} {% endif %}{{ status.app_version }}
    </div>
</div>
{% endblock %}
